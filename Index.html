<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPA Calculator</title>
</head>
<body>
    <h1>GPA Calculator</h1>
    <input id="studyNum" type="text" placeholder="Enter your study number">
    <button id="calcButton">Calculate GPA</button>
    <div id="result"></div>

    <script>
        const gradeToGPA = {
            F: 0,
            D: 0.5,
            DD: 1,
            C: 1.5,
            CC: 2,
            B: 2.5,
            BB: 3,
            A: 3.5,
            AA: 4
        };

        const subjects = [
            { name: "Math1", units: 12, urls: ["https://pastebin.com/raw/xBmPwP5u", "https://pastebin.com/raw/4WscJMh0"] }, // new first, then old
            { name: "Physics1", units: 12, urls: ["https://pastebin.com/raw/XZeQHFSs", "https://pastebin.com/raw/VsZXLGnF"] },
            { name: "English1", units: 9, urls: ["https://pastebin.com/raw/ZZsjVX30", "https://pastebin.com/raw/AxmBtNeE"] },
            { name: "Statistics", units: 9, urls: ["https://pastebin.com/raw/2WeYNGM2", "https://pastebin.com/raw/DY08wqAx"] },
            { name: "Arabic", units: 6, urls: ["https://pastebin.com/raw/S5R0pKKn", "https://pastebin.com/raw/pUdtTdDC"] },
            { name: "Computer", units: 9, urls: ["https://pastebin.com/raw/8fZNVW1s", "https://pastebin.com/raw/xM78SjCp"] },
            { name: "Math2", units: 12, urls: ["https://pastebin.com/raw/eSiuC5ML"] },
            { name: "Physics2", units: 12, urls: ["https://pastebin.com/raw/e3FQwB9q"] },
            { name: "Chemistry", units: 9, urls: ["https://pastebin.com/raw/izG7PzL5"] },
            { name: "Drawing", units: 6, urls: ["https://pastebin.com/raw/QGnc3Duj"] },
            { name: "English2", units: 9, urls: ["https://pastebin.com/raw/yBdzjstv"] }
        ];

        async function getGradeForSubject(studyNum, subject) {
            for (let url of subject.urls) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) continue;
                    const text = await response.text();
                    const lines = text.split('\n');
                    for (let line of lines) {
                        const parts = line.split(' : ');
                        if (parts.length === 2) {
                            const num = parts[0].trim();
                            const grade = parts[1].trim();
                            if (num === studyNum) {
                                return grade;
                            }
                        }
                    }
                } catch (error) {
                    console.error(`Error fetching ${url}: ${error}`);
                }
            }
            return null;
        }

        async function calculateGPA() {
            const studyNum = document.getElementById('studyNum').value.trim();
            if (!studyNum) {
                document.getElementById('result').innerText = 'Please enter a study number.';
                return;
            }

            let totalPoints = 0;
            let totalUnits = 0;
            let missingSubjects = [];

            for (let subject of subjects) {
                const grade = await getGradeForSubject(studyNum, subject);
                if (grade && gradeToGPA[grade] !== undefined) {
                    const gpaValue = gradeToGPA[grade];
                    totalPoints += gpaValue * subject.units;
                    totalUnits += subject.units;
                } else {
                    missingSubjects.push(subject.name);
                }
            }

            if (missingSubjects.length > 0) {
                document.getElementById('result').innerText = `Grades not found for: ${missingSubjects.join(', ')}. Cannot calculate GPA.`;
                return;
            }

            if (totalUnits === 0) {
                document.getElementById('result').innerText = 'No units found. Cannot calculate GPA.';
                return;
            }

            const gpa = totalPoints / totalUnits;
            document.getElementById('result').innerText = `Your GPA is ${gpa.toFixed(2)}`;
        }

        document.getElementById('calcButton').addEventListener('click', calculateGPA);
    </script>
</body>
</html>
